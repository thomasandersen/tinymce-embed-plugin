(function(){tinymce.PluginManager.requireLangPack("embed");var a=/^(mceItemIframe|mceItemFlash|mceItemShockWave|mceItemWindowsMedia|mceItemQuickTime|mceItemRealMedia)$/;tinymce.create("tinymce.plugins.embed",{init:function(b,c){var d=this;function e(f){return a.test(f.className)}d.url=c;d.editor=b;b.onInit.add(function(){if(b.settings.content_css!==false){b.dom.loadCSS(c+"/css/embed.css")}});b.addCommand("enonicEmbed",function(){b.windowManager.open({file:c+"/window.html",width:620+b.getLang("embed.delta_width",0),height:540+b.getLang("embed.delta_height",0),inline:1},{plugin_url:c})});b.addButton("embed",{title:"embed.desc",cmd:"enonicEmbed",image:c+"/img/embed.gif"});b.onNodeChange.add(function(g,f,h){f.setActive("embed",e(h))});b.onSetContent.add(function(f,g){d.iframesToImages(g)});b.onPreProcess.add(function(f,g){if(g.get){d.imagesToIframes(g)}});b.onPostProcess.add(function(f,g){g.content=g.content.replace(/(<iframe.+?)_iframe_innerhtml="(.+?)"(.+?)(<\/iframe>)/gi,function(){return arguments[1]+arguments[3]+d.editor.dom.decode(arguments[2])+arguments[4]})})},getInfo:function(){return{longname:"Embed",author:"Thomas Andersen (thomas@mr-andersen.no)",authorurl:"http://www.mr-andersen.no.com",infourl:"http://www.mr-andersen.no.com",version:"1.0"}},imagesToIframes:function(g){var c=this,e=c.editor,f=e.dom,d;var b=f.select('img[class="mceItemIframe"]',g.node);tinymce.each(b,function(h){d=c.createIframeElement(h);f.replace(d,h)})},iframesToImages:function(f){var b=this,c=b.editor,e=c.dom,g;var d=e.select("iframe",f.node);tinymce.each(d,function(h){g=b.createImagePlaceHolder(h,f);e.replace(g,h)})},createIframeElement:function(d){var j=this,g=j.editor,e=g.dom;var f=j._parseImagePlaceHolderTitle(d);var h="";if("innerhtml" in f){h=f.innerhtml;delete f.innerhtml}var b=e.getAttrib(d,"width");var i=e.getAttrib(d,"height");var c=e.create("iframe",f);e.setAttrib(c,"width",b);e.setAttrib(c,"height",i);e.setAttrib(c,"_iframe_innerhtml",h);return c},createImagePlaceHolder:function(h,c){var l=this,i=l.editor,g=i.dom;var e,j,b,k,d,f;b=g.getAttrib(h,"width");k=g.getAttrib(h,"height");j=l._serializeIframeAttributes(h);d=g.getAttrib(h,"_iframe_innerhtml");f=(d!=="")?d:g.decode(h.innerHTML);if(!c.initial){f=g.decode(f)}if(f===""||/^\s*$/.test(f)){f="This browser does not support the iframe element."}j+=',"innerhtml":"'+tinymce.trim(f)+'"';e=g.create("img");g.setAttrib(e,"src",l.url+"/img/trans.gif");g.setAttrib(e,"title",j);g.setAttrib(e,"width",b);g.setAttrib(e,"height",k);g.addClass(e,"mceItemIframe");g.setStyle(e,"width",b);g.setAttrib(e,"style",0);return e},_parseImagePlaceHolderTitle:function(e){var b=this,c=b.editor;var d=c.dom.getAttrib(e,"title");return tinymce.util.JSON.parse("{"+d+"}")},_serializeIframeAttributes:function(d){var j=this,h=j.editor,c=h.dom,g,f,k;var b=["src","width","height","longdesc","name","frameborder","marginwidth","marginheight","scrolling","align","id","class","style","title"];var e={};for(var i in b){f=b[i];k=c.getAttrib(d,f);g=k!=="";if(g){e[f]=k}}return tinymce.util.JSON.serialize(e).replace(/[{}]/g,"")}});tinymce.PluginManager.add("embed",tinymce.plugins.embed)})();