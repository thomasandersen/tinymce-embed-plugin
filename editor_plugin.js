(function(){tinymce.PluginManager.requireLangPack("embed");var b=/(<iframe\s.+?>)(|.+?)(<\/iframe>)/gi;var a="$1{iframe_element_content}$3";var c=/^(mceItemIframe|mceItemFlash|mceItemShockWave|mceItemWindowsMedia|mceItemQuickTime|mceItemRealMedia)$/;tinymce.create("tinymce.plugins.embed",{init:function(d,e){var f=this;function g(h){return c.test(h.className)}f.url=e;f.editor=d;d.onInit.add(function(){if(d.settings.content_css!==false){d.dom.loadCSS(e+"/css/embed.css")}});d.addCommand("enonicEmbed",function(){d.windowManager.open({file:e+"/window.html",width:620+d.getLang("embed.delta_width",0),height:540+d.getLang("embed.delta_height",0),inline:1},{plugin_url:e})});d.addButton("embed",{title:"embed.desc",cmd:"enonicEmbed",image:e+"/img/embed.gif"});d.onNodeChange.add(function(i,h,j){h.setActive("embed",g(j))});d.onGetContent.add(function(h,i){i.content=f.addContentToIframes(i.content)});d.onSaveContent.add(function(h,i){i.content=f.addContentToIframes(i.content)});d.onSetContent.add(function(h,i){f.iframesToImages(i)});d.onPreProcess.add(function(h,i){if(i.get){f.imagesToIframes(i)}})},getInfo:function(){return{longname:"Embed",author:"Thomas Andersen (thomas@mr-andersen.no)",authorurl:"http://www.mr-andersen.no.com",infourl:"http://www.mr-andersen.no.com",version:"1.0"}},imagesToIframes:function(i){var e=this,g=e.editor,h=g.dom,f;var d=h.select('img[class="mceItemIframe"]',i.node);tinymce.each(d,function(j){f=e.createIframeElement(j);h.replace(f,j)})},iframesToImages:function(h){var d=this,e=d.editor,g=e.dom,i;var f=g.select("iframe",h.node);tinymce.each(f,function(j){i=d.createImagePlaceHolder(j);g.replace(i,j)})},createIframeElement:function(k){var e=this,h=e.editor,j=h.dom;var i=e._parseImagePlaceHolderTitle(k);var g=j.getAttrib(k,"width");var d=j.getAttrib(k,"height");var f=j.create("iframe",i);j.setAttrib(f,"width",g);j.setAttrib(f,"height",d);return f},createImagePlaceHolder:function(h){var e=this,g=e.editor,k=g.dom;var i,j,f,d;f=k.getAttrib(h,"width");d=k.getAttrib(h,"height");j=e._serializeIframeAttributes(h);i=k.create("img");k.setAttrib(i,"src",e.url+"/img/trans.gif");k.setAttrib(i,"title",j);k.setAttrib(i,"width",f);k.setAttrib(i,"height",d);k.addClass(i,"mceItemIframe");k.setStyle(i,"width",f);k.setAttrib(i,"style",0);return i},addContentToIframes:function(d){return d.replace(b,a)},_parseImagePlaceHolderTitle:function(g){var d=this,e=d.editor;var f=e.dom.getAttrib(g,"title");return tinymce.util.JSON.parse("{"+f+"}")},_serializeIframeAttributes:function(f){var l=this,j=l.editor,e=j.dom,i,h,m;var d=["src","width","height","longdesc","name","frameborder","marginwidth","marginheight","scrolling","align","id","class","style","title"];var g={};for(var k in d){h=d[k];m=e.getAttrib(f,h);i=m!=="";if(i){g[h]=m}}return tinymce.util.JSON.serialize(g).replace(/[{}]/g,"")}});tinymce.PluginManager.add("embed",tinymce.plugins.embed)})();