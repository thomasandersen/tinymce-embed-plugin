(function(){tinymce.PluginManager.requireLangPack("embed");tinymce.create("tinymce.plugins.embed",{init:function(a,b){var c=this;function d(e){return c.imagePlaceholderPattern.test(e.className)}c.url=b;c.editor=a;c.iframeContent="Default content";c.iframePattern=/(<iframe\s.+?>)(|.+?)(<\/iframe>)/gi;c.iframeReplacePattern="$1"+c.getIframeContent()+"$3";c.imagePlaceholderPattern=/^(mceItemIframe|mceItemFlash|mceItemShockWave|mceItemWindowsMedia|mceItemQuickTime|mceItemRealMedia)$/;a.onInit.add(function(){if(a.settings.content_css!==false){a.dom.loadCSS(b+"/css/embed.css")}});a.addCommand("enonicEmbed",function(){a.windowManager.open({file:b+"/window.html",width:620+a.getLang("embed.delta_width",0),height:540+a.getLang("embed.delta_height",0),inline:1},{plugin_url:b})});a.addButton("embed",{title:"embed.desc",cmd:"enonicEmbed",image:b+"/img/embed.gif"});a.onNodeChange.add(function(f,e,g){e.setActive("embed",d(g))});a.onGetContent.add(function(e,f){f.content=c.addContentToIframes(f.content)});a.onSaveContent.add(function(e,f){f.content=c.addContentToIframes(f.content)});a.onSetContent.add(function(e,f){c.iframesToImages(f)});a.onPreProcess.add(function(e,f){if(f.get){c.imagesToIframes(f)}})},getInfo:function(){return{longname:"Embed",author:"Thomas Andersen (thomas@mr-andersen.no)",authorurl:"http://www.mr-andersen.no.com",infourl:"http://www.mr-andersen.no.com",version:"1.0"}},imagesToIframes:function(f){var b=this,d=b.editor,e=d.dom,c;var a=e.select('img[class="mceItemIframe"]',f.node);tinymce.each(a,function(g){c=b.createIframeElement(g);e.replace(c,g)})},iframesToImages:function(e){var a=this,b=a.editor,d=b.dom,f;var c=d.select("iframe",e.node);tinymce.each(c,function(g){f=a.createImagePlaceHolder(g);d.replace(f,g)})},createIframeElement:function(c){var i=this,f=i.editor,d=f.dom;var e=i._parseImagePlaceHolderTitle(c);var g="";if("content" in e){g=e.content;i.setIframeContent(g);delete e.content}var a=d.getAttrib(c,"width");var h=d.getAttrib(c,"height");var b=d.create("iframe",e);d.setAttrib(b,"width",a);d.setAttrib(b,"height",h);return b},createImagePlaceHolder:function(e){var b=this,d=b.editor,h=d.dom;var f,g,c,a;c=h.getAttrib(e,"width");a=h.getAttrib(e,"height");g=b._serializeIframeAttributes(e);f=h.create("img");h.setAttrib(f,"src",b.url+"/img/trans.gif");h.setAttrib(f,"title",g);h.setAttrib(f,"width",c);h.setAttrib(f,"height",a);h.addClass(f,"mceItemIframe");h.setStyle(f,"width",c);h.setAttrib(f,"style",0);return f},addContentToIframes:function(b){var a=this;return b.replace(a.iframePattern,a.iframeReplacePattern)},setIframeContent:function(b){var a=this;if(b!==""){a.iframeContent=b}},getIframeContent:function(b){var a=this;return a.iframeContent},_parseImagePlaceHolderTitle:function(d){var a=this,b=a.editor;var c=b.dom.getAttrib(d,"title");return tinymce.util.JSON.parse("{"+c+"}")},_serializeIframeAttributes:function(c){var i=this,g=i.editor,b=g.dom,f,e,j;var a=["src","width","height","longdesc","name","frameborder","marginwidth","marginheight","scrolling","align","id","class","style","title"];var d={};for(var h in a){e=a[h];j=b.getAttrib(c,e);f=j!=="";if(f){d[e]=j}}d.content=i.getIframeContent();i.setIframeContent(d.content);alert(i.getIframeContent());return tinymce.util.JSON.serialize(d).replace(/[{}]/g,"")}});tinymce.PluginManager.add("embed",tinymce.plugins.embed)})();